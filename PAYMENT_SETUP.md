# Настройка платежной системы ЮКassa

## Шаг 1: Регистрация в ЮКassa

1. Перейдите на https://yookassa.ru
2. Зарегистрируйте магазин (потребуется ИНН: 616116993432)
3. Пройдите модерацию (обычно 1-3 дня)

## Шаг 2: Получение ключей

После одобрения магазина:

1. Войдите в личный кабинет ЮКassa
2. Перейдите в раздел **Настройки → Данные магазина**
3. Скопируйте **shopId** (например: 123456)
4. Перейдите в раздел **Настройки → Секретные ключи**
5. Создайте новый секретный ключ для работы с API
6. Скопируйте **secret_key** (например: live_abc...xyz)

## Шаг 3: Добавление ключей в проект

### Обязательные ключи для платежей:

1. **YOOKASSA_SHOP_ID** - ваш shopId из личного кабинета ЮКassa
2. **YOOKASSA_SECRET_KEY** - секретный ключ для API ЮКassa

### Обязательные ключи для генерации контента (см. AI_SETUP.md):

3. **OPENAI_API_KEY** - ключ OpenAI для генерации текстов через GPT-4
4. **REPLICATE_API_TOKEN** - токен Replicate для генерации видео
5. **STABILITY_API_KEY** - ключ Stability AI для генерации изображений

Все поля для секретов уже созданы в интерфейсе poehali.dev

## Шаг 4: Настройка webhook

Для автоматического подтверждения платежей:

1. В личном кабинете ЮКassa перейдите **Настройки → Уведомления**
2. Добавьте URL для webhook:
   ```
   https://functions.poehali.dev/27df6ed9-65dc-4de2-a8cd-fe95d756af17?action=webhook
   ```
3. Выберите события: **payment.succeeded**
4. Сохраните настройки

## Шаг 5: Настройка чеков (54-ФЗ)

Для автоматического формирования чеков:

1. В ЮКassa перейдите **Настройки → Чеки**
2. Укажите данные организации:
   - **Наименование**: ИП ЗВЕРЕВ АЛЕКСЕЙ СЕРГЕЕВИЧ
   - **ИНН**: 616116993432
   - **Email для чеков**: Rpmxxx@mail.ru
   - **Система налогообложения**: УСН (выберите вашу)
3. Подключите онлайн-кассу или ОФД
4. Активируйте отправку чеков

## Способы оплаты

Система поддерживает:

- **СБП (Система быстрых платежей)** - мгновенные переводы через банковское приложение
- **Банковские карты** - Visa, Mastercard, МИР
- **Автопродление** - автоматическое списание при окончании подписки

## Тестирование

Для тестирования платежей используйте тестовые карты ЮКassa:

- **Успешный платеж**: 5555 5555 5555 4477
- **Отклоненный платеж**: 5555 5555 5555 4444
- **3-D Secure**: 5555 5555 5555 5599

CVC: любой, Срок: любая будущая дата

## Тарифы

Настроены следующие тарифы:

1. **Старт** - Бесплатно
   - 5 видео в месяц
   - 10 текстов в месяц
   - 3 презентации

2. **Про** - 990₽/мес
   - 50 видео в месяц
   - Безлимит текстов
   - 30 презентаций
   - Full HD качество

3. **Бизнес** - 2990₽/мес
   - Безлимит всего
   - 4K качество
   - Персональный менеджер

## База данных

Создана структура таблиц:

- `users` - пользователи
- `subscriptions` - подписки с автопродлением
- `payments` - история платежей с чеками

## API Endpoints

### Регистрация и авторизация
```
POST https://functions.poehali.dev/53733180-4915-4c21-a626-7d1329e4117e?action=register
POST https://functions.poehali.dev/53733180-4915-4c21-a626-7d1329e4117e?action=login
GET  https://functions.poehali.dev/53733180-4915-4c21-a626-7d1329e4117e?action=profile
```

### Платежи
```
POST https://functions.poehali.dev/27df6ed9-65dc-4de2-a8cd-fe95d756af17?action=create
POST https://functions.poehali.dev/27df6ed9-65dc-4de2-a8cd-fe95d756af17?action=cancel
```

## Безопасность

- Все пароли хешируются SHA-256
- Токены авторизации с HMAC-SHA256 подписью
- Срок действия токена: 30 дней
- HTTPS для всех запросов

## Поддержка

При возникновении проблем:
- Email: Rpmxxx@mail.ru
- Телефон: +7 928 226-46-38